# Database (Prisma + Postgres)

This project uses Prisma ORM with a Postgres database. The shared Prisma client lives in `packages/db` and is reused by the web app via a small server util.

## Models

See `packages/db/prisma/schema.prisma` for the initial schema:

- Project: stores project metadata and JSON payload
- Render: stores render status, URL and errors, related to a Project

## Setup

1) Run Postgres locally (Docker or local service)
- Example Docker: `docker run --name canva-lite-pg -e POSTGRES_PASSWORD=postgres -e POSTGRES_USER=postgres -e POSTGRES_DB=canva_lite -p 5432:5432 -d postgres:16`

2) Configure env
- Set `DATABASE_URL` in `.env` (see `.env.example` for a template)

3) Generate Prisma Client
- `pnpm db:generate` (loads root `.env` and runs Prisma for the db package)

4) Create and apply migrations
- `pnpm db:migrate -- --name init` (reads root `.env`)

Note: We run Prisma from the workspace root with `--schema packages/db/prisma/schema.prisma` so the CLI uses the root `.env` for `DATABASE_URL`.

## Using the client

- Server helper in web: `apps/web/src/server/db.ts`
- Import and use: `import { prisma } from '@/server/db'` (server-only)

## Verification

- After running migrations, confirm `Project` and `Render` tables exist (e.g., `psql` or a DB UI)
